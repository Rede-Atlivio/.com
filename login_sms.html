<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login SMS F√°cil</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="max-w-md w-full bg-gray-800 p-6 rounded-xl shadow-2xl text-center">
        <h1 class="text-xl font-bold text-green-400 mb-2">üì± ACESSO R√ÅPIDO</h1>
        <p class="text-gray-400 text-[10px] mb-6">Digite seu n√∫mero para entrar</p>

        <div id="step-phone" class="space-y-4">
            <label class="block text-left text-xs font-bold text-gray-500">SEU CELULAR</label>
            
            <div class="relative">
                <span class="absolute left-3 top-3.5 text-gray-400 text-lg">üáßüá∑ +55</span>
                <input type="tel" id="phone-number" 
                       placeholder="(75) 99999-0000" 
                       maxlength="15"
                       oninput="mascaraTelefone(this)"
                       class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 pl-20 text-white text-lg focus:border-green-500 outline-none">
            </div>
            
            <button onclick="enviarSMS()" id="btn-send" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg shadow-lg transition">
                RECEBER C√ìDIGO VIA SMS
            </button>
            <p class="text-[10px] text-gray-500 mt-2">Voc√™ receber√° um c√≥digo de 6 d√≠gitos.</p>
        </div>

        <div id="step-code" class="hidden space-y-4 animate-pulse">
            <div class="bg-blue-900/30 p-3 rounded border border-blue-500/30 mb-4">
                <p class="text-xs text-blue-200">Enviamos um SMS para <span id="lbl-phone" class="font-bold text-white">...</span></p>
                <p class="text-[10px] text-gray-400 mt-1">Se for n√∫mero de teste, use o c√≥digo cadastrado.</p>
            </div>
            
            <label class="block text-left text-xs font-bold text-gray-500">C√ìDIGO DE 6 D√çGITOS</label>
            <input type="tel" id="sms-code" placeholder="000000" maxlength="6" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white text-2xl tracking-[0.5em] text-center focus:border-blue-500 outline-none">
            
            <button onclick="verificarCodigo()" id="btn-verify" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg shadow-lg transition">
                ENTRAR AGORA üöÄ
            </button>
            
            <button onclick="location.reload()" class="text-xs text-gray-500 underline mt-2">N√∫mero errado? Corrigir.</button>
        </div>

        <div id="recaptcha-container" class="mt-4 flex justify-center"></div>
        <div id="status-log" class="hidden mt-4 text-[10px] text-red-400 bg-black/50 p-2 rounded"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // CONFIGURA√á√ÉO
        const firebaseConfig = { 
            apiKey: "AIzaSyCj89AhXZ-cWQXUjO7jnQtwazKXInMOypg", 
            authDomain: "atlivio-oficial-a1a29.firebaseapp.com", 
            projectId: "atlivio-oficial-a1a29", 
            storageBucket: "atlivio-oficial-a1a29.firebasestorage.app", 
            messagingSenderId: "887430049204", 
            appId: "1:887430049204:web:d205864a4b42d6799dd6e1" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        auth.languageCode = 'pt-br';

        // üé® M√ÅSCARA AUTOM√ÅTICA MELHORADA (V23.0)
window.mascaraTelefone = (input) => {
    let v = input.value.replace(/\D/g,''); // Remove tudo que n√£o √© n√∫mero
    if (v.length > 11) v = v.substring(0, 11);
    
    if (v.length > 2) {
        v = `(${v.substring(0,2)}) ${v.substring(2)}`;
    }
    if (v.length > 9) {
        v = `${v.substring(0,10)}-${v.substring(10)}`;
    }
    
    input.value = v;
};

// ENVIAR SMS COM TRATAMENTO DE ERRO BLINDADO
window.enviarSMS = async () => {
    let rawPhone = document.getElementById('phone-number').value;
    let cleanPhone = rawPhone.replace(/\D/g, ''); // Garante que s√≥ fiquem n√∫meros

    // Valida√ß√£o de tamanho para Brasil (DDD + 9 d√≠gitos ou 8 d√≠gitos)
    if(cleanPhone.length < 10) return alert("Digite o n√∫mero completo com DDD (Ex: 75 99999-0000)");

    const finalPhone = '+55' + cleanPhone;
    console.log("üì≤ Tentando enviar para:", finalPhone);

    const btn = document.getElementById('btn-send');
    btn.disabled = true;
    btn.innerHTML = `<span class="animate-pulse">Enviando... ‚è≥</span>`;

    setupRecaptcha();
    const appVerifier = window.recaptchaVerifier;

    try {
        const confirmationResult = await signInWithPhoneNumber(auth, finalPhone, appVerifier);
        window.confirmationResult = confirmationResult;
        
        document.getElementById('lbl-phone').innerText = finalPhone;
        document.getElementById('step-phone').classList.add('hidden');
        document.getElementById('step-code').classList.remove('hidden');
        document.getElementById('step-code').classList.remove('animate-pulse');

    } catch (error) {
        console.error("‚ùå Erro Firebase:", error.code);
        if(window.recaptchaVerifier) window.recaptchaVerifier.clear();
        window.recaptchaVerifier = null;
        btn.disabled = false;
        btn.innerText = "RECEBER C√ìDIGO VIA SMS";
        
        // Alertas amig√°veis
        if(error.code === 'auth/invalid-phone-number') alert("N√∫mero inv√°lido! Verifique o DDD.");
        else if(error.code === 'auth/too-many-requests') alert("Bloqueio tempor√°rio: Muitas tentativas. Aguarde 15 minutos.");
        else alert("Erro ao enviar SMS: " + error.message);
    }
};

        // VERIFICAR
        window.verificarCodigo = async () => {
            const code = document.getElementById('sms-code').value;
            if(code.length < 6) return alert("O c√≥digo deve ter 6 n√∫meros.");

            const btn = document.getElementById('btn-verify');
            btn.disabled = true;
            btn.innerText = "Validando...";

            try {
                const result = await window.confirmationResult.confirm(code);
                alert(`‚úÖ SUCESSO!\n\nUsu√°rio Logado:\n${result.user.uid}`);
                btn.innerText = "BEM-VINDO!";
                btn.classList.add('bg-green-600');
            } catch (error) {
                btn.disabled = false;
                btn.innerText = "ENTRAR AGORA üöÄ";
                alert("C√≥digo incorreto. Tente novamente.");
            }
        };
        
        setupRecaptcha();
    </script>
</body>
</html>
